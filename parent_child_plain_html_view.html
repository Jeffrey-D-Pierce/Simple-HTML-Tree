<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="./images/favicon.ico" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Example - Parent Child Hierarchy"
    />
    <title>Example Parent Child Hierarchy</title>
    <script src="./src/main.js" type="module"></script>
    <link href="./src/main.css" rel="stylesheet" />
    <!-- Custom Content -->
    <script src="./src/custom_content.js"></script>
    <link href="./src/custom_content.css" rel="stylesheet" />
    <!-- Control Scripts -->
    <script src="./src/control/scale_control.js"></script>
    <script src="./src/control/drag_control.js"></script>
    <!-- Example Data -->
    <script src="./src/example_data/items_ccc.js"></script>
    <script src="./src/example_data/items_constraints.js"></script>
    <script src="./src/example_data/items.js"></script>
    <script src="./src/example_data/items_html.js"></script>
  </head>
  <body>
    <!-- Control Panel -->
    <div id="control-panel">
      <label for="content-checkbox">Custom Content:</label>
      <input type="checkbox" id="content-checkbox" checked name="content-checkbox">

      <select name="example-data" id="example-data-select">
        <option value="1">Example</option>
        <option value="0">HTML</option>
        <option value="2">CCC</option>
        <option value="3">Constraints</option>
      </select>
      <select name="options" id="options-select">
        <option value="horizontal">Horizontal</option>
        <option value="vertical">Vertical</option>
        <option value="centered">Centered</option>
      </select>
      <!-- Slider element -->
      <div>
        <input type="range" id="scale-slider" min="10" max="300" value="100">
        <!-- Display the value -->
        <div id="slider-value">Current Value: 100</div>
      </div>
    </div>
    <!-- Root Container - Hierachy displays here -->
    <div id="root-container">
      <div id="root"  class="css-connector"></div>
    </div>

    <!-- Script to initially render example data -->
    <script>
      let items
      let orientation
      customContentOriginal = customContent
      document.addEventListener('DOMContentLoaded', function() {
        items = items_example
        Parent_Child_Hierarchy.render({rootElement: "root", items, customContent });
      })
    </script>

    <!-- Script to control display -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {

        // Example: Handle event on an entity (a parent or child)
        document.getElementById("root").addEventListener("mousedown", (e)=>{
          var entity = e.target.closest('.entity');
          if (entity && entity.querySelector('.notes')) {
            entity.querySelector('.notes').style.display = "block"
          }
          // console.log("mousedown", e.target)
        })

        document.getElementById("root").addEventListener("mouseup", (e)=>{
          var entity = e.target.closest('.entity');
          if (entity && entity.querySelector('.notes')) {
            entity.querySelector('.notes').style.display = "none"
          }
          // console.log("mouseup", e.target)
        })
      })

      // Handle the Selection to Change the Custom Content
      document.addEventListener('DOMContentLoaded', function() {
        var checkbox = document.getElementById('content-checkbox');
        
        checkbox.addEventListener('change', function() {
          if(this.checked) {
            addCSS('./src/custom_content.css')
            customContent = customContentOriginal
            Parent_Child_Hierarchy.render({rootElement: "root", items, customContent});
          } else {
            customContent = undefined
            removeCSS('custom_content.css')
            Parent_Child_Hierarchy.clearCustomContent()
            Parent_Child_Hierarchy.render({rootElement: "root", items, customContent});
          }
        });
      });


      // Handle the Selection to Change the Orientation
      var selectElement = document.getElementById('options-select');

      selectElement.addEventListener('change', (event) => {
          orientation = event.target.value;
          // Call a function here with the selected value
          Parent_Child_Hierarchy.render({ rootElement: "root", orientation, items, customContent });
      });

      // Handle the Selection to Change the example data
      document.getElementById('example-data-select').addEventListener('change', (event) => {
        if(event.target.value === "1") {
          items = items_example
        } else if (event.target.value === "0") {
          items = items_html
        } else if (event.target.value === "2") {
          items = items_ccc
        } else {
          items = items_constraints
        }
        Parent_Child_Hierarchy.render({ rootElement: "root", items, orientation, customContent });
      });

      // Handle the events to change the scale

      // Select the slider and the value display element
      const slider = document.getElementById('scale-slider');
      const sliderValueDisplay = document.getElementById('slider-value');
      
      // Add an event listener for the 'input' event on the slider
      slider.addEventListener('input', function() {
        // Update the display with the current value of the slider
        sliderValueDisplay.textContent = 'Current Value: ' + this.value;
        // Select the root element
        var rootElement = document.getElementById('root'); // replace 'root' with your actual root element's ID
      
        // Set the scale
        var scaleValue = this.value / 100; // for 80% scale
      
        // Apply the transform style to scale
        // rootElement.style.transform = 'scale(' + scaleValue + ')';
        updateScale(rootElement, scaleValue)
      
      });

      // Setup drag control
      dragControl('root')
      dragControl('control-panel', true)

      function addCSS(css_file) {
        var link = document.createElement('link');
        link.href = css_file;
        link.rel = 'stylesheet';
        link.type = 'text/css';

        document.head.appendChild(link);
      }

      function removeCSS(css_file) {
        var links = document.getElementsByTagName('link');
        for (var i = 0; i < links.length; i++) {
            var link = links[i];
            if (link.href && link.href.includes(css_file)) {
                link.parentNode.removeChild(link);
                break;
            }
        }
      }

      </script>
  </body>
</html>
